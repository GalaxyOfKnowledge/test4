// Basic Space Invaders with Trivia Quiz
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Player
const player = {
  x: canvas.width / 2 - 25,
  y: canvas.height - 60,
  width: 50,
  height: 50,
  speed: 5,
  bullets: []
};

// Enemies
const enemies = [];
const enemyRows = 3;
const enemyCols = 5;

for (let r = 0; r < enemyRows; r++) {
  for (let c = 0; c < enemyCols; c++) {
    enemies.push({
      x: c * 60 + 30,
      y: r * 50 + 30,
      width: 40,
      height: 40,
      alive: true
    });
  }
}

// Trivia Questions
const triviaQuestions = [
  { question: "What is the national fruit of the Philippines?", options: ["Mango", "Banana", "Durian"], answer: "Mango" },
  { question: "Who is known as the 'Father of Philippine Revolution'?", options: ["Jose Rizal", "Andres Bonifacio", "Emilio Aguinaldo"], answer: "Andres Bonifacio" }
];

let currentQuestion = null;
let isTriviaActive = false;

// Controls
document.addEventListener("keydown", (event) => {
  if (event.key === "ArrowLeft" && player.x > 0) player.x -= player.speed;
  if (event.key === "ArrowRight" && player.x < canvas.width - player.width) player.x += player.speed;
  if (event.key === " " && !isTriviaActive) player.bullets.push({ x: player.x + 20, y: player.y, speed: 5 });
});

// Game Loop
function update() {
  if (!isTriviaActive) {
    // Move bullets
    player.bullets.forEach((bullet, index) => {
      bullet.y -= bullet.speed;
      if (bullet.y < 0) player.bullets.splice(index, 1);
    });

    // Check for enemy hits
    enemies.forEach((enemy, eIndex) => {
      if (enemy.alive) {
        player.bullets.forEach((bullet, bIndex) => {
          if (
            bullet.x < enemy.x + enemy.width &&
            bullet.x + 5 > enemy.x &&
            bullet.y < enemy.y + enemy.height &&
            bullet.y + 10 > enemy.y
          ) {
            enemies[eIndex].alive = false;
            player.bullets.splice(bIndex, 1);
          }
        });
      }
    });

    // Check if all enemies are defeated
    if (enemies.every(enemy => !enemy.alive)) {
      isTriviaActive = true;
      showTrivia();
    }
  }
  draw();
  requestAnimationFrame(update);
}

// Draw game elements
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Draw player
  ctx.fillStyle = "blue";
  ctx.fillRect(player.x, player.y, player.width, player.height);
  
  // Draw bullets
  ctx.fillStyle = "red";
  player.bullets.forEach(bullet => ctx.fillRect(bullet.x, bullet.y, 5, 10));
  
  // Draw enemies
  ctx.fillStyle = "green";
  enemies.forEach(enemy => {
    if (enemy.alive) ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
  });
}

// Trivia Mechanism
function showTrivia() {
  currentQuestion = triviaQuestions[Math.floor(Math.random() * triviaQuestions.length)];
  const answer = prompt(`${currentQuestion.question}\n${currentQuestion.options.join(" | ")}`);
  if (answer === currentQuestion.answer) {
    alert("Correct! You get a power-up!");
  } else {
    alert("Wrong answer! The game gets harder!");
  }
  resetGame();
}

// Reset Game for Next Round
function resetGame() {
  enemies.forEach(enemy => enemy.alive = true);
  isTriviaActive = false;
}

update();
